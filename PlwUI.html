<!DOCTYPE html>
<meta charset="UTF-8">
<html><head><title>PL/W</title></head><body>

<script src="PlwTokenReader.js"></script>
<script src="PlwAst.js"></script>
<script src="PlwParser.js"></script>
<script src="PlwCompiler.js"></script>
<script src="PlwRefManager.js"></script>
<script src="PlwStackMachine.js"></script>
<script src="PlwNativeFunctionManager.js"></script>
<script src="PlwUI.js"></script>

<input type="button" value="exec" onclick="onExecClick(false)">
<input type="button" value="debug" onclick="onExecClick(true)">
<input type="button" value="eval" onclick="onEvalClick()">
<label for="snippets">Snippets</label><select id="snippets" onchange="onSnippetChange()"><option value=""></option></select><br>
<textarea id="textin" rows="10" cols="100"></textarea><br>
<input type="button" value="clear messages" onclick="onClearMessageClick()">
<input type="button" value="display context" onclick="onDisplayContextClick()">
<input type="button" value="display stack machine" onclick="onDisplayStackMachineClick()">
<input type="button" value="reset context" onclick="onResetContextClick()"><br>
<textarea id="textout" rows="10" cols="100"></textarea><br>
<textarea id="debug" rows="10" cols="100"></textarea>

<p id="snippet-variable-title" class="snippet">Variable</p>
<pre id="snippet-variable">
var i integer := 2 + 3 * 4;
i := i / 2;
print('i = ' || text(i) || ', expected 7');
i := 8 % 3;
print('i = ' || text(i) || ', expected 2');
i := (2 + 3) * 4;
i := 5 - i;
print('i = ' || text(i) || ', expected -15');
var b boolean := true or true and false;
print('b = ' || text(b) || ', expected true');
b := (true or true) and false;
print('b = ' || text(b) || ', expected false');
b := 1 = 2;
print('b = ' || text(b) || ', expected false');
b := 2 = 2;
print('b = ' || text(b) || ', expected true');
b := 1 < 2;
print('b = ' || text(b) || ', expected true');
b := 1 > 2;
print('b = ' || text(b) || ', expected false');
b := 2 < 2;
print('b = ' || text(b) || ', expected false');
b := 2 > 2;
print('b = ' || text(b) || ', expected false');
b := 1 <= 2;
print('b = ' || text(b) || ', expected true');
b := 1 >= 2;
print('b = ' || text(b) || ', expected false');
b := 2 <= 2;
print('b = ' || text(b) || ', expected true');
b := 2 >= 2;
print('b = ' || text(b) || ', expected true');
b := 1 <> 2;
print('b = ' || text(b) || ', expected true');
b := 2 <> 2;
print('b = ' || text(b) || ', expected false');
var t text := 'Hello' || ' ';
t := t || 'World';
print('t = ' || t || ', expected Hello World');
t := subtext(t, 3, 5);
print('t = ' || t || ', expected lo Wo');
</pre>

<p id="snippet-real-title" class="snippet">Real</p>
<pre id="snippet-real">
var i real := 2.2 + 3.3 * 4.4;
i := i / 2.2;
print('i = ' || text(i) || ', expected 7.6');
i := (2.2 + 3.3) * 4.4;
i := 5.5 - i;
print('i = ' || text(i) || ', expected -18.7');
var b boolean := 1.1 = 2.2;
print('b = ' || text(b) || ', expected false');
b := 2.2 = 2.2;
print('b = ' || text(b) || ', expected true');
b := 1.1 < 2.2;
print('b = ' || text(b) || ', expected true');
b := 1.1 > 2.2;
print('b = ' || text(b) || ', expected false');
b := 2.2 < 2.2;
print('b = ' || text(b) || ', expected false');
b := 2.2 > 2.2;
print('b = ' || text(b) || ', expected false');
b := 1.1 <= 2.2;
print('b = ' || text(b) || ', expected true');
b := 1.1 >= 2.2;
print('b = ' || text(b) || ', expected false');
b := 2.2 <= 2.2;
print('b = ' || text(b) || ', expected true');
b := 2.2 >= 2.2;
print('b = ' || text(b) || ', expected true');
b := 1.1 <> 2.2;
print('b = ' || text(b) || ', expected true');
b := 2.2 <> 2.2;
print('b = ' || text(b) || ', expected false');
</pre>

<p id="snippet-flow-control-title" class="snippet">Flow Control</p>
<pre id="snippet-flow-control">
if 2 = 1 + 1 then
  print('Good');
else
  print('Error: alternate reality');
end if;
if not (2 = 1 + 1) then
  print('Error: alternate reality');
end if;
if 2 <> 1 + 1 then
  print('Error: alternate reality');
else
  print('Good');
end if;
if 2 <> 1 + 1 then
  print('Error: alternate reality');
elsif 2 = 1 + 1 then
  print('Good');
else
  print('Error: alternate reality');
end if;
if 2 <> 1 + 1 then
  print('Error: alternate reality');
elsif 4 <> 2 + 2 then
  print('Error: alternate reality');
else
  print('Good');
end if;
print('Done if, 4 Good expected');
var i integer := 10;
while i <= 100 loop
  print(text(i));
  i := i + 10;
end loop;
while i <= 100 loop
  print('Error: alternate reality');
end loop;
print('Done while'); 
</pre>

<p id="snippet-arrays-title" class="snippet">Arrays</p>
<pre id="snippet-arrays">
var a [integer] := [integer := 11, 22, 33, 44, 55];
var b integer := a[1];
var c [integer] := a[2..4];
var d [integer] := c || [integer := 66, 77];
if b = 22 and c = [integer := 33, 44, 55] and d = [integer := 33, 44, 55, 66, 77] then
  print('Good');
else
  print('Error: alternate reality');
end if;
var aa [[integer]] := [[integer] := [integer := 11, 12], [integer := 22, 23],
  [integer := 33, 34], [integer := 44], [integer := 55, 56, 57]];
var bb [integer] := aa[1];
var cc [[integer]] := aa[1..2];
var dd [[integer]] := cc || [[integer] := [integer := 66, 67, 68], [integer :=]];
if
  bb = [integer := 22, 23] and
  cc = [[integer] := [integer := 22, 23], [integer := 33, 34]] and
  dd = [[integer] := [integer := 22, 23], [integer := 33, 34], [integer := 66, 67, 68], [integer :=]]
then
  print('Good');
else
  print('Error: alternate reality');
end if;
var at [text] := [text := '11', '22', '33', '44', '55'];
var bt text := at[1];
var ct [text] := at[2..3];
var dt [text] := ct || [text := '66', '77'];
if bt = '22' and ct = [text := '33', '44'] and dt = [text := '33', '44', '66', '77'] then
  print('Good');
else
  print('Error: alternate reality');
end if;
</pre>

<p id="snippet-basic-procedure-title" class="snippet">Basic Procedure</p>
<pre id="snippet-basic-procedure">
procedure say_hello(name text) begin
  if name = 'HAL' then
    print('Hello HAL, are you the HAL from 2001 ?');
    return;
  end if;
  print('Hello ' || name || ', nice to meet you');
end say_hello;
say_hello('HAL');
say_hello('Jane Smith');
</pre>


<p id="snippet-basic-function-title" class="snippet">Basic function</p>
<pre id="snippet-basic-function">
var toto integer := 42;
function f(a integer) integer begin
  toto := toto + a;
  return toto + 1;
end f;
print('f(toto): ' || text(f(toto)));
print('expected: 85');
</pre>

<p id="snippet-nested-functions-title" class="snippet">Nested functions</p>
<pre id="snippet-nested-functions">
function add(a integer, b integer) integer begin
  return a + b;
end add;
function double(a integer) integer begin
  var sum integer := add(a, a);
  return sum;
end double;
print('double(3): ' || text(double(3)));
print('expected: 6');
</pre>

<p id="snippet-first-100-primes-title" class="snippet">First 100 Primes</p>
<pre id="snippet-first-100-primes">
var primes_count integer := 100;
function isprime(n integer) boolean begin
  for i in 2 .. n - 1 loop
    if n % i = 0 then
      return false;
    end if;
  end loop;
  return true;
end isprime;
var first_primes [integer] := array(0, primes_count);
begin
  var i integer := 1;
  var index integer := 0;
  while index < primes_count loop
    if isprime(i) then
      first_primes[index] := i;
      index := index + 1;
    end if;
    i := i + 1;
  end loop;
end;
print('first_primes: ' || text(first_primes));
</pre>

<p id="snippet-recursive-facto-title" class="snippet">Recursive Facto</p>
<pre id="snippet-recursive-facto">
function facto(a integer) integer begin
  if a = 0 then
    return 1;
  else
    return a * facto(a - 1);
  end if;
end facto;
print(text(facto(5)));
</pre>

<p id="snippet-fibonacci-title" class="snippet">Fibonacci</p>
<pre id="snippet-fibonacci">
function fibo(n integer) integer begin
  if n = 0 or n = 1 then
    return n;
  else
    return fibo(n - 1) + fibo(n - 2);
  end if;
end fibo;
print(text(fibo(10)));
</pre>

<p id="snippet-bubble-sort-title" class="snippet">Bubble Sort</p>
<pre id="snippet-bubble-sort">
function bubble_sort(nums [integer]) [integer] begin
  for i in reverse 0 .. length(nums) - 2 loop
    for j in 0 .. i loop
      if nums[j] > nums[j + 1] then
        var tmp integer := nums[j];
        nums[j] := nums[j + 1];
        nums[j + 1] := tmp;
      end if;
    end loop;
  end loop;
  return nums;
end bubble_sort;
print(text(bubble_sort([integer := 77, 66, 99, 88, 55, 44, 22, 33,  -22, 11, 0, -11])));
</pre>

<p id="snippet-html-escape-title" class="snippet">Html Escape</p>
<pre id="snippet-html-escape">
function html_escape(t text) text begin
  var esc := '';
  for i in 0..length(t) - 1 loop
    var c := subtext(t, i, 1);
    if c = '&gt;' then
      esc := esc || '&amp;gt;';
    elsif c = '&lt;' then
      esc := esc || '&amp;lt';
    elsif c = '&amp;' then
      esc := esc || '&amp;amp;';
    elsif c = '&quot;' then
      esc := esc || '&amp;quot;';
    else
      esc := esc || c;
    end if; 
  end loop;
  return esc;
end html_escape;
print(html_escape('in C bitwise op is & and shift is << or >> (ex: "(a & 0xFF00) >> 8")'));  
</pre>

<p id="snippet-records-title" class="snippet">Records</p>
<pre id="snippet-records">
var r1 { i integer, b boolean } := { i integer := 42, b boolean := true };
if r1.i = 42 and r1.b then
  print('Good');
else
  print('Error: alternate reality');
end if;
r1.i := 51;
r1.b := false;
if r1.i = 51 and not r1.b then
  print('Good');
else
  print('Error: alternate reality');
end if;
</pre>

<p id="snippet-assign-records-title" class="snippet">Assign record</p>
<pre id="snippet-assign-records">
procedure init_record(r { a integer, b [integer] }, a integer, b [integer]) begin
  r.a := a;
  r.b := b;
end init_record;
var v { a integer, b [integer] } := { a integer := 0, b [integer] := [integer := 0] };
init_record(v, 42, [integer := 51]);
print('a = ' || text(v.a) || ', b = ' || text(v.b));
</pre>

<p id="snippet-type-inference-title" class="snippet">Type inference</p>
<pre id="snippet-type-inference">
var i := 42;
var b := true;
var v := [:= 42, 51];
var t := 'Hello';
var r := { i := 42, b := true, v := [:= 42, 51], t := 'Hello' };
if     i - r.i = 0
   and ((b and r.b) or (not b and not r.b))
   and v[0] - r.v[0] = 0 and v[1] - r.v[1] = 0
   and t || r.t = 'HelloHello'
then
  print('Good');
else
  print('Error: alternate reality');
end if;
</pre>

<p id="snippet-simple-generator-title" class="snippet">Simple Generator</p>
<pre id="snippet-simple-generator">
generator gen_range_step(first integer, last integer, step integer) integer begin
  var current integer := first;
  while current <= last loop
    yield current;
    current := current + step;
  end loop;
end gen_range_step;
for i in gen_range_step(42, 51, 3) loop
  print(text(i));
end loop;
</pre>

<p id="snippet-simple-generator-with-refs-title" class="snippet">Simple Generator With refs</p>
<pre id="snippet-simple-generator-with-refs">
generator gen_concat(words [text], final_int integer) text begin
  var word_count integer := length(words);
  var phrase text := '';
  yield text(word_count);
  for i in 0 .. word_count - 1 loop
    phrase := phrase || words[i];
    yield phrase;
  end loop;
  yield text(final_int);
end gen_concat;
for i in gen_concat([text := 'hello', ' the', ' world'], 42) loop
  print(i);
end loop;
</pre>

<p id="snippet-generator-html-title" class="snippet">Generator Html</p>
<pre id="snippet-generator-html">
type employee {
  first_name text,
  last_name text,
  skills [text]
};
function employee(first_name text, last_name text, skills [text]) employee begin
  var e employee := { first_name text := first_name, last_name text := last_name, skills [text] := skills };
  return e;
end employee;
generator fetch_employees() employee begin
  yield employee('John', 'Backer', [text := 'C++', 'SQL']);
  yield employee('Jane', 'Smith', [text := 'Java', 'HTML']);
  yield employee('Alan', 'Carpenter', [text := 'Ksh', 'Scrum']);
end fetch_employees;
generator employee_table(with_header boolean, employees sequence(employee)) text begin
  yield '&lt;table&gt;';
  for employee in employees loop
    yield '&lt;tr&gt;&lt;td&gt;' || employee.first_name
       || '&lt;/td&gt;&lt;td&gt;' || employee.last_name
       || '&lt;/td&gt;&lt;td&gt;' || text(employee.skills) || '&lt;/td&gt;&lt;tr&gt;';
  end loop;
  yield '&lt;/table&gt;';
end employee_table;
for html_frag in employee_table(false, fetch_employees()) loop
  print(html_frag);
end loop;
</pre>

<script>fillSnippetSelect()</script>
</body></html>
